import { PrismaClient } from '@prisma/client';
import * as bcrypt from 'bcrypt';

const prisma = new PrismaClient();

async function main() {
  console.log('üå± –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏...');

  // 1. –°–æ–∑–¥–∞–µ–º —Ä–æ–ª–∏
  console.log('üìù –°–æ–∑–¥–∞–µ–º —Ä–æ–ª–∏...');
  const adminRole = await prisma.role.upsert({
    where: { name: 'admin' },
    update: {},
    create: {
      name: 'admin',
      description: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–∏—Å—Ç–µ–º—ã',
    },
  });

  const userRole = await prisma.role.upsert({
    where: { name: 'user' },
    update: {},
    create: {
      name: 'user',
      description: '–û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
    },
  });

  const mentorRole = await prisma.role.upsert({
    where: { name: 'mentor' },
    update: {},
    create: {
      name: 'mentor',
      description: '–ú–µ–Ω—Ç–æ—Ä/–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å',
    },
  });

  // 2. –°–æ–∑–¥–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
  console.log('üéØ –°–æ–∑–¥–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏...');
  const frontendSpec = await prisma.specialization.upsert({
    where: { name: 'Frontend Developer' },
    update: {},
    create: {
      name: 'Frontend Developer',
      description: '–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤',
    },
  });

  const backendSpec = await prisma.specialization.upsert({
    where: { name: 'Backend Developer' },
    update: {},
    create: {
      name: 'Backend Developer',
      description: '–°–µ—Ä–≤–µ—Ä–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏ API',
    },
  });

  const fullstackSpec = await prisma.specialization.upsert({
    where: { name: 'Fullstack Developer' },
    update: {},
    create: {
      name: 'Fullstack Developer',
      description: '–ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏',
    },
  });

  // 3. –°–æ–∑–¥–∞–µ–º –Ω–∞–≤—ã–∫–∏
  console.log('üí™ –°–æ–∑–¥–∞–µ–º –Ω–∞–≤—ã–∫–∏...');
  const skills = [
    { name: 'JavaScript', category: 'Programming' },
    { name: 'TypeScript', category: 'Programming' },
    { name: 'React', category: 'Frontend' },
    { name: 'Vue.js', category: 'Frontend' },
    { name: 'Node.js', category: 'Backend' },
    { name: 'NestJS', category: 'Backend' },
    { name: 'PostgreSQL', category: 'Database' },
    { name: 'MongoDB', category: 'Database' },
    { name: 'Docker', category: 'DevOps' },
    { name: 'Git', category: 'Tools' },
  ];

  const createdSkills = [];
  for (const skill of skills) {
    const createdSkill = await prisma.skill.upsert({
      where: { name: skill.name },
      update: {},
      create: skill,
    });
    createdSkills.push(createdSkill);
  }

  // 4. –°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  console.log('üë• –°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...');
  const passwordHash = await bcrypt.hash('password123', 10);

  const adminUser = await prisma.user.upsert({
    where: { email: 'admin@example.com' },
    update: {},
    create: {
      email: 'admin@example.com',
      passwordHash,
      firstName: '–ê–¥–º–∏–Ω',
      lastName: '–°–∏—Å—Ç–µ–º—ã',
      dataProcessingConsent: true,
      emailVerified: true,
    },
  });

  const mentorUser = await prisma.user.upsert({
    where: { email: 'mentor@example.com' },
    update: {},
    create: {
      email: 'mentor@example.com',
      passwordHash,
      firstName: '–ò–≤–∞–Ω',
      lastName: '–ú–µ–Ω—Ç–æ—Ä',
      phone: '+7 (999) 123-45-67',
      dataProcessingConsent: true,
      emailVerified: true,
    },
  });

  const testUser = await prisma.user.upsert({
    where: { email: 'user@example.com' },
    update: {},
    create: {
      email: 'user@example.com',
      passwordHash,
      firstName: '–ü–µ—Ç—Ä',
      lastName: '–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫',
      phone: '+7 (999) 987-65-43',
      dataProcessingConsent: true,
      emailVerified: true,
    },
  });

  // 5. –ù–∞–∑–Ω–∞—á–∞–µ–º —Ä–æ–ª–∏
  console.log('üîê –ù–∞–∑–Ω–∞—á–∞–µ–º —Ä–æ–ª–∏...');
  await prisma.userRole.upsert({
    where: {
      userId_roleId: {
        userId: adminUser.id,
        roleId: adminRole.id,
      },
    },
    update: {},
    create: {
      userId: adminUser.id,
      roleId: adminRole.id,
    },
  });

  await prisma.userRole.upsert({
    where: {
      userId_roleId: {
        userId: mentorUser.id,
        roleId: mentorRole.id,
      },
    },
    update: {},
    create: {
      userId: mentorUser.id,
      roleId: mentorRole.id,
    },
  });

  await prisma.userRole.upsert({
    where: {
      userId_roleId: {
        userId: testUser.id,
        roleId: userRole.id,
      },
    },
    update: {},
    create: {
      userId: testUser.id,
      roleId: userRole.id,
    },
  });

  // 6. –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Ñ–∏–ª–∏
  console.log('üìã –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Ñ–∏–ª–∏...');
  const mentorProfile = await prisma.profile.upsert({
    where: { userId: mentorUser.id },
    update: {},
    create: {
      userId: mentorUser.id,
      specializationId: fullstackSpec.id,
      aboutMe: '–û–ø—ã—Ç–Ω—ã–π fullstack —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ —Å 5+ –≥–æ–¥–∞–º–∏ –æ–ø—ã—Ç–∞',
      specialistLevel: 'Senior',
      location: '–ú–æ—Å–∫–≤–∞, –†–æ—Å—Å–∏—è',
    },
  });

  const userProfile = await prisma.profile.upsert({
    where: { userId: testUser.id },
    update: {},
    create: {
      userId: testUser.id,
      specializationId: frontendSpec.id,
      aboutMe: 'Junior frontend —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫, –∏–∑—É—á–∞—é React',
      specialistLevel: 'Junior',
      location: '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥, –†–æ—Å—Å–∏—è',
    },
  });

  // 7. –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞–≤—ã–∫–∏ –∫ –ø—Ä–æ—Ñ–∏–ª—è–º
  console.log('üéØ –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞–≤—ã–∫–∏ –∫ –ø—Ä–æ—Ñ–∏–ª—è–º...');
  const mentorSkills = [
    { skillName: 'JavaScript', level: 9 },
    { skillName: 'TypeScript', level: 8 },
    { skillName: 'React', level: 9 },
    { skillName: 'Node.js', level: 8 },
    { skillName: 'NestJS', level: 7 },
    { skillName: 'PostgreSQL', level: 8 },
  ];

  for (const skillData of mentorSkills) {
    const skill = createdSkills.find((s) => s.name === skillData.skillName);
    if (skill) {
      await prisma.profileSkill.upsert({
        where: {
          profileId_skillId: {
            profileId: mentorProfile.id,
            skillId: skill.id,
          },
        },
        update: {},
        create: {
          profileId: mentorProfile.id,
          skillId: skill.id,
          level: skillData.level,
        },
      });
    }
  }

  // 8. –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç
  console.log('üìù –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç—ã...');
  const jsTest = await prisma.test.upsert({
    where: { title: 'JavaScript –û—Å–Ω–æ–≤—ã' },
    update: {},
    create: {
      title: 'JavaScript –û—Å–Ω–æ–≤—ã',
      description: '–¢–µ—Å—Ç –Ω–∞ –∑–Ω–∞–Ω–∏–µ –æ—Å–Ω–æ–≤ JavaScript',
      durationMinutes: 30,
      createdById: mentorUser.id,
      isPublished: true,
    },
  });

  // 9. –°–æ–∑–¥–∞–µ–º –≤–æ–ø—Ä–æ—Å—ã
  console.log('‚ùì –°–æ–∑–¥–∞–µ–º –≤–æ–ø—Ä–æ—Å—ã...');
  const question1 = await prisma.question.create({
    data: {
      testId: jsTest.id,
      content: '–ß—Ç–æ –≤—ã–≤–µ–¥–µ—Ç console.log(typeof null)?',
      type: 'multiple_choice',
      correctAnswer: 'object',
      score: 10,
      createdById: mentorUser.id,
      isApproved: true,
    },
  });

  // –í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è –≤–æ–ø—Ä–æ—Å–∞ 1
  await prisma.answerOption.createMany({
    data: [
      { questionId: question1.id, content: 'null', isCorrect: false },
      { questionId: question1.id, content: 'object', isCorrect: true },
      { questionId: question1.id, content: 'undefined', isCorrect: false },
      { questionId: question1.id, content: 'string', isCorrect: false },
    ],
  });

  const question2 = await prisma.question.create({
    data: {
      testId: jsTest.id,
      content:
        '–ö–∞–∫–æ–π –º–µ—Ç–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞ –≤ –∫–æ–Ω–µ—Ü –º–∞—Å—Å–∏–≤–∞?',
      type: 'multiple_choice',
      correctAnswer: 'push',
      score: 10,
      createdById: mentorUser.id,
      isApproved: true,
    },
  });

  // –í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è –≤–æ–ø—Ä–æ—Å–∞ 2
  await prisma.answerOption.createMany({
    data: [
      { questionId: question2.id, content: 'push()', isCorrect: true },
      { questionId: question2.id, content: 'pop()', isCorrect: false },
      { questionId: question2.id, content: 'shift()', isCorrect: false },
      { questionId: question2.id, content: 'unshift()', isCorrect: false },
    ],
  });

  // 10. –°–≤—è–∑—ã–≤–∞–µ–º —Ç–µ—Å—Ç —Å–æ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π
  console.log('üîó –°–≤—è–∑—ã–≤–∞–µ–º —Ç–µ—Å—Ç —Å–æ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π...');
  await prisma.specializationTest.upsert({
    where: {
      specializationId_testId: {
        specializationId: frontendSpec.id,
        testId: jsTest.id,
      },
    },
    update: {},
    create: {
      specializationId: frontendSpec.id,
      testId: jsTest.id,
      isRequired: true,
    },
  });

  // 11. –°–æ–∑–¥–∞–µ–º —É—á–µ–±–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
  console.log('üìö –°–æ–∑–¥–∞–µ–º —É—á–µ–±–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã...');
  await prisma.learningMaterial.upsert({
    where: { title: '–í–≤–µ–¥–µ–Ω–∏–µ –≤ JavaScript' },
    update: {},
    create: {
      title: '–í–≤–µ–¥–µ–Ω–∏–µ –≤ JavaScript',
      content: `# –í–≤–µ–¥–µ–Ω–∏–µ –≤ JavaScript

JavaScript - —ç—Ç–æ –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π, –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ–º—ã–π —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è.

## –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:
- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö
- –§—É–Ω–∫—Ü–∏–∏
- –û–±—ä–µ–∫—Ç—ã –∏ –º–∞—Å—Å–∏–≤—ã
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ

## –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞:
\`\`\`javascript
const greeting = "–ü—Ä–∏–≤–µ—Ç, –º–∏—Ä!";
console.log(greeting);
\`\`\``,
      specializationId: frontendSpec.id,
      createdById: mentorUser.id,
      isPublished: true,
    },
  });

  console.log('‚úÖ –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∑–∞–≤–µ—Ä—à–µ–Ω–æ!');
  console.log('üìä –°–æ–∑–¥–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:');
  console.log('- 3 —Ä–æ–ª–∏ (admin, user, mentor)');
  console.log('- 3 —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (Frontend, Backend, Fullstack)');
  console.log('- 10 –Ω–∞–≤—ã–∫–æ–≤');
  console.log('- 3 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
  console.log('- 2 –ø—Ä–æ—Ñ–∏–ª—è');
  console.log('- 1 —Ç–µ—Å—Ç —Å 2 –≤–æ–ø—Ä–æ—Å–∞–º–∏');
  console.log('- 1 —É—á–µ–±–Ω—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª');
  console.log('');
  console.log('üîë –¢–µ—Å—Ç–æ–≤—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã:');
  console.log('- admin@example.com / password123 (–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)');
  console.log('- mentor@example.com / password123 (–ú–µ–Ω—Ç–æ—Ä)');
  console.log('- user@example.com / password123 (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)');
}

main()
  .catch((e) => {
    console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏ –ë–î:', e);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });
